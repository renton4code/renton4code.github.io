(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["view-History-vue"],{"07f8":function(t,e,s){"use strict";s("bb42")},5279:function(t,e,s){"use strict";s("f0a0")},"7a46":function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("section",{staticClass:"reports_section"},[t.shouldShowOrderDetailsDialog?s("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:t.isLoadingDetails,expression:"isLoadingDetails"}],staticClass:"history-order-detail",attrs:{visible:t.shouldShowOrderDetailsDialog},on:{"visible-change":t.changeOrderDetailVisibility}},[s("history-order-details",{on:{backAction:function(){return t.changeOrderDetailVisibility(!1)}}})],1):t._e(),s("h2",[t._v(t._s(t.$t("tab.history")))]),s("div",{staticClass:"reports_header"},[s("div",{staticClass:"filter_section_content_order filter_section_content_step"},[s("br"),s("el-input",{staticClass:"input-with-select search-input",attrs:{placeholder:t.$t("reports.filter.order.hint")},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.searchByCode(e)}},model:{value:t.searchFilter.code,callback:function(e){t.$set(t.searchFilter,"code",e)},expression:"searchFilter.code"}},[s("el-button",{attrs:{slot:"append"},on:{click:t.searchByCode},slot:"append"},[s("font-awesome-icon",{attrs:{icon:"search"}})],1)],1),s("button",{staticClass:"el-dialog__clearbtn green_btn",on:{click:function(e){t.filterModalDisplayed=!0}}},[t._v(" "+t._s(t.$t("reports.filter"))+" "),t.selectedFilters?s("span",{staticClass:"show-selected-filters"},[t._v(" "+t._s(t.selectedFilters)+" ")]):t._e()]),s("div",{staticClass:"reports_header_refresh",on:{click:function(e){return t.refresh(t.filteredIds)}}},[s("icon",{attrs:{name:"refresh_icon"}})],1),s("br"),s("br")],1)]),s("el-collapse",{model:{value:t.activeNames,callback:function(e){t.activeNames=e},expression:"activeNames"}},[s("el-collapse-item",{attrs:{title:t.$t("summary.title"),name:"1"}},[s("div",{staticClass:"left_summary"},[s("pair",{staticClass:"bold",attrs:{left:t.$t("reports.history.sales.title"),right:t._f("currency")(t.sales.total)}}),s("pair",{attrs:{left:t.$t("reports.history.sales.cash"),right:t._f("currency")(t.sales.cashTotal)}}),s("pair",{attrs:{left:t.$t("reports.history.sales.card"),right:t._f("currency")(t.sales.cardTotal)}}),s("div",{staticClass:"separator"}),s("pair",{staticClass:"bold",attrs:{left:t.$t("reports.history.sales.refund"),right:t._f("currency")(0-t.sales.totalRefund)}}),s("pair",{staticClass:"bold",attrs:{left:t.$t("reports.history.sales.cancellation"),right:t._f("currency")(-t.sales.cancelledTotal)}}),s("div",{staticClass:"separator strong"}),s("pair",{staticClass:"bold",attrs:{left:t.$t("reports.history.sales.netvalue"),right:t._f("currency")(t.sales.netValue)}})],1),s("div",{staticClass:"right_summary"},[s("pair",{staticClass:"bold",attrs:{left:t.$t("reports.history.sales.total.order"),right:t.sales.totalOrders}}),s("pair",{attrs:{left:t.$t("reports.history.sales.cash"),right:t.sales.cashOrders}}),s("pair",{attrs:{left:t.$t("reports.history.sales.card"),right:t.sales.cardOrders}}),s("div",{staticClass:"separator"}),s("pair",{staticClass:"bold",attrs:{left:t.$t("reports.history.sales.avg"),right:t._f("currency")(t.sales.avgOrderValue)}}),s("div",{staticClass:"separator"})],1)])],1),s("br"),s("div",{staticClass:"history-results"},[s("div",{staticClass:"reports_header_preview_data_time"},[t._v(" "+t._s(t.$t("reports.history.time.title"))+" ")]),s("div",{staticClass:"reports_header_export"},[s("a",{staticClass:"green_btn",attrs:{title:"export"},on:{click:function(e){return t.excel()}}},[t._v(" "+t._s(t.$t("reports.history.export"))+" ")])]),s("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"reports_list"},[s("div",{staticClass:"reports_list_table"},[s("div",{staticClass:"reports_list_body_row reports_list_head"},[s("div",{staticClass:"reports_list_body_td reports_list_body_th"},[s("span",[t._v(t._s(t.$t("reports.history.date")))])]),s("div",{staticClass:"reports_list_body_td reports_list_body_th"},[t._v(" "+t._s(t.$t("reports.history.orderId"))+" ")]),s("div",{staticClass:"reports_list_body_td reports_list_body_th"},[t._v(" "+t._s(t.$t("order.products.price"))+" ")]),s("div",{staticClass:"reports_list_body_td reports_list_body_th"},[t._v(" "+t._s(t.$t("ticket.pickup.code"))+" ")]),s("div",{staticClass:"reports_list_body_td reports_list_body_th"},[t._v(" "+t._s(t.$t("order.store.city"))+" ")]),s("div",{staticClass:"reports_list_body_td reports_list_body_th"},[t._v(" "+t._s(t.$t("order.store.name"))+" ")]),s("div",{staticClass:"reports_list_body_td reports_list_body_td_wide reports_list_body_th"},[t._v(" "+t._s(t.$t("order.store.address"))+" ")])]),s("div",{staticClass:"reports_list_body"},t._l(t.reportOrders[t.pagination.currentPage],(function(e){return s("div",{key:e.id,staticClass:"reports_list_body_row",on:{click:function(s){return t.showOrderDetail(e)}}},[s("div",{staticClass:"reports_list_date reports_list_body_td"},[s("div",{staticClass:"reports_list_date_date"},[t._v(" "+t._s(t._f("formatDate")(e.dispatchingTime))+" ")]),s("div",{staticClass:"reports_list_date_time"},[t._v(" "+t._s(t._f("formatHours")(e.dispatchingTime))+" ")])]),s("div",{staticClass:"reports_list_body_td"},[s("div",{staticClass:"reports_list_body_code"},[t._v(" "+t._s(e.code)+" ")]),s("div",{staticClass:"reports_list_body_code"},[e.refundIncident&&e.refundIncident.reason?s("icon",{attrs:{name:"refund-icon"}}):t._e(),t.hasBadRatings(e)?s("icon",{attrs:{name:"unlike-icon"}}):t._e(),"CanceledStatus"===e.currentStatus?s("icon",{attrs:{name:"cancel-icon"}}):t._e()],1)]),s("div",{staticClass:"reports_list_body_td"},[s("div",{staticClass:"reports_list_currency_price"},[t._v(" "+t._s(t.totalPrice(e))+" ")]),"CASH"===e.paymentMethod?s("div",{staticClass:"reports_list_currency_payment"},[s("icon",{attrs:{name:"cash-icon"}})],1):t._e()]),s("div",{staticClass:"reports_list_body_td",attrs:{"data-qa":"pick-up-code"}},[t._v(" "+t._s(t.pickupCodeText(e))+" ")]),s("div",{staticClass:"reports_list_body_td"},[t._v(" "+t._s(e.cityName)+" ")]),s("div",{staticClass:"reports_list_body_td"},[t._v(" "+t._s(e.storeName)+" ")]),s("div",{staticClass:"reports_list_body_td reports_list_body_td_wide"},[t._v(" "+t._s(e.storeAddress)+" ")])])})),0)]),s("el-pagination",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:t.loading,expression:"loading",modifiers:{fullscreen:!0,lock:!0}}],attrs:{"element-loading-text":t.$t("sa.stats.loading"),layout:"prev, pager, next",total:t.pagination.totalPages,"current-page":t.currentPage,"page-size":1},on:{"update:currentPage":function(e){t.currentPage=e},"update:current-page":function(e){t.currentPage=e},"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)]),s("filter-popup",{attrs:{"filter-modal-displayed":t.filterModalDisplayed,"handle-close":t.changeFilterModalDisplay,mcd:t.isMCD},on:{"update-addresses":t.updateSelectedAddresses,handleClose:t.changeFilterModalDisplay,saved:t.filterReports}})],1)},r=[],a=(s("4de4"),s("b64b"),s("96cf"),s("1da1")),o=s("5530"),l=s("2f62"),d=s("72d6"),n=s("73f7"),c=function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.dialogVisible?s("el-dialog",{staticClass:"historical-filter",attrs:{title:t.$t("reports.filter.title"),visible:t.dialogVisible,"before-close":t.handleClose},on:{"update:visible":function(e){t.dialogVisible=e}}},[s("el-form",{staticClass:"historic-form"},[t.availableStoreAddresses.length>1?s("div",{staticClass:"filter_section_content_step"},[s("h3",[t._v(t._s(t.$t("reports.filter.stores")))]),s("store-address-selector",{attrs:{options:t.selectedStoreAddresses},on:{"selection-change":t.updateSelectedIdsForFiltering}})],1):t._e(),s("div",{staticClass:"filter_section_content_incidence filter_section_content_step"},[s("h3",[t._v(t._s(t.$t("reports.filter.incidences")))]),s("el-checkbox",{staticClass:"filter_section_item",attrs:{disabled:t.filterOptions.code.length>0},model:{value:t.filterOptions.incidents.badRating,callback:function(e){t.$set(t.filterOptions.incidents,"badRating",e)},expression:"filterOptions.incidents.badRating"}},[t._v(" "+t._s(t.$t("reports.filter.incidence.badRating"))+" ")]),s("el-checkbox",{staticClass:"filter_section_item",attrs:{disabled:t.filterOptions.code.length>0},model:{value:t.filterOptions.incidents.cancelled,callback:function(e){t.$set(t.filterOptions.incidents,"cancelled",e)},expression:"filterOptions.incidents.cancelled"}},[t._v(" "+t._s(t.$t("reports.filter.incidence.canceled"))+" ")]),s("el-checkbox",{staticClass:"filter_section_item",attrs:{disabled:t.filterOptions.code.length>0},model:{value:t.filterOptions.incidents.orderWithRefund,callback:function(e){t.$set(t.filterOptions.incidents,"orderWithRefund",e)},expression:"filterOptions.incidents.orderWithRefund"}},[t._v(" "+t._s(t.$t("reports.filter.incidence.refund"))+" ")])],1),s("div",{staticClass:"filter_section_content_period filter_section_content_step"},[s("h3",[t._v(t._s(t.$t("reports.filter.onlyCash.title")))]),s("el-checkbox",{staticClass:"filter_section_item",model:{value:t.filterOptions.courierPaidWithCash,callback:function(e){t.$set(t.filterOptions,"courierPaidWithCash",e)},expression:"filterOptions.courierPaidWithCash"}},[t._v(" "+t._s(t.$t("reports.filter.onlyCash.text"))+" ")]),s("el-checkbox",{staticClass:"filter_section_item",model:{value:t.filterOptions.orderPaidWithCard,callback:function(e){t.$set(t.filterOptions,"orderPaidWithCard",e)},expression:"filterOptions.orderPaidWithCard"}},[t._v(" "+t._s(t.$t("reports.filter.card.text"))+" ")])],1),s("div",{staticClass:"filter_section_content_period filter_section_content_step"},[s("h3",[t._v(t._s(t.$t("reports.filter.period")))]),s("el-select",{attrs:{"data-qa":"picker-select"},model:{value:t.filterOptions.period.option,callback:function(e){t.$set(t.filterOptions.period,"option",e)},expression:"filterOptions.period.option"}},t._l(t.pickerOptions.shortcuts,(function(t){return s("el-option",{key:t.name,attrs:{"data-qa":"picker-option-"+t.name,value:t.name,label:t.text,name:t.text}})})),1),s("div",{staticClass:"period_date-pickers"},["custom"===t.filterOptions.period.option?s("el-date-picker",{attrs:{type:"date",placeholder:t.$t("from.label"),"unlink-panels":""},on:{change:t.changeDate},model:{value:t.form.period.start,callback:function(e){t.$set(t.form.period,"start",e)},expression:"form.period.start"}}):t._e(),"custom"===t.filterOptions.period.option?s("el-date-picker",{attrs:{type:"date",placeholder:t.$t("until.label"),"unlink-panels":""},on:{change:t.changeDate},model:{value:t.form.period.end,callback:function(e){t.$set(t.form.period,"end",e)},expression:"form.period.end"}}):t._e()],1)],1)]),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("glovo-btn",{attrs:{text:t.$t("reports.filter.clear"),type:"transparent-green"},on:{clack:t.cleanFilter}}),s("el-button",{directives:[{name:"loading",rawName:"v-loading",value:t.filterForm.loading,expression:"filterForm.loading"}],staticClass:"apply",attrs:{disabled:t.actionDisabled,type:"success","data-qa":"apply-changes"},on:{click:function(e){return t.saveParameters()}}},[t._v(" "+t._s(t.$t("reports.filter.button"))+" ")])],1)],1):t._e()},p=[],h=(s("d3b7"),s("ddb0"),s("7f45")),f=s.n(h),u=s("432a"),_=s("314e"),v=s("40c5"),b={name:"FilterPopup",components:{GlovoBtn:_["a"],StoreAddressSelector:u["default"]},props:{mcd:{type:Boolean},filterModalDisplayed:{type:Boolean},handleClose:{type:Function,required:!0}},data:function(){return{form:{period:{start:null,end:null}},filterOptions:{period:{start:f()().subtract(6,"months").startOf("day").valueOf(),end:f()().endOf("day").valueOf(),option:"all"},incidents:{badRating:!1,cancelled:!1,orderWithRefund:!1},courierPaidWithCash:!1,orderPaidWithCard:!1,code:""},pickerOptions:{shortcuts:{all:{text:this.$i18n.t("reports.filter.periods.all"),name:"all",values:{end:f()(),start:f()().subtract(6,"months").startOf("day")}},today:{text:this.$i18n.t("reports.filter.periods.today"),name:"today",values:{end:f()(),start:f()().startOf("day")}},yesterday:{text:this.$i18n.t("reports.filter.periods.yesterday"),name:"yesterday",values:{start:f()().subtract(1,"days").startOf("day"),end:f()().subtract(1,"days").endOf("day")}},lastWeek:{text:this.$i18n.t("reports.filter.periods.week"),name:"lastWeek",values:{end:f()(),start:f()().subtract(7,"days").startOf("day")}},"2Weeks":{text:this.$i18n.t("reports.filter.periods.2Weeks"),name:"2Weeks",values:{end:f()(),start:f()().subtract(15,"days").startOf("day")}},custom:{text:this.$i18n.t("reports.filter.periods.custom"),name:"custom"}}},filterForm:{loading:!1},filteredStoreAddressIds:[]}},computed:Object(o["a"])(Object(o["a"])(Object(o["a"])({},Object(l["c"])(["searchFilter"])),Object(l["c"])("authentication",[v["c"],v["f"]])),{},{selectedStoreAddresses:function(){return this[v["f"]]},availableStoreAddresses:function(){return this[v["c"]]},dialogVisible:{get:function(){return this.filterModalDisplayed},set:function(t){t||this.$emit("handle-close")}},actionDisabled:function(){return!this.filterOptions.period.option||!("custom"!==this.filterOptions.period.option||this.form.period.start&&this.form.period.end)}}),watch:{dialogVisible:function(t){this.dialogVisible=t},filterOptions:function(){this.filterOptions||(this.filterOptions=Object.assign({},this.searchFilter)),"custom"===this.filterOptions.period.option&&(this.form.period.start=f()(this.filterOptions.period.start),this.form.period.end=f()(this.filterOptions.period.end))}},methods:{changeDate:function(){if(this.form.period.start&&this.form.period.end&&this.form.period.start.valueOf()>this.form.period.end.valueOf()){var t=this.form.period.start;this.form.period.start=this.form.period.end,this.form.period.end=t}(this.form.period.start||this.form.period.end)&&(this.filterOptions.period.option="custom")},updateSelectedIdsForFiltering:function(t){this.filteredStoreAddressIds=t,this.$emit("update-addresses",t)},cleanFilter:function(){this.filterOptions={period:{start:f()().startOf("day").utc().valueOf(),end:f()().endOf("day").endOf("day").utc().valueOf(),option:"all"},incidents:{badRating:!1,cancelled:!1,orderWithRefund:!1},onlyCash:!1,card:!1,courierPaidWithCash:!1,orderPaidWithCard:!1,code:""},this.availableStoreAddresses.length>1&&(this.filteredStoreAddressIds=[],this.$emit("update-addresses",[]))},saveParameters:function(){var t="custom"!==this.filterOptions.period.option?{start:this.pickerOptions.shortcuts[this.filterOptions.period.option].values.start.startOf("day").valueOf(),end:this.pickerOptions.shortcuts[this.filterOptions.period.option].values.end.endOf("day").valueOf()}:{start:f()(this.form.period.start).startOf("day").valueOf(),end:f()(this.form.period.end).endOf("day").valueOf()};this.$emit("saved",Object(o["a"])(Object(o["a"])({},this.filterOptions),{},{period:Object(o["a"])(Object(o["a"])({},t),{},{option:this.filterOptions.period.option})}))}}},y=b,m=(s("5279"),s("2877")),g=Object(m["a"])(y,c,p,!1,null,null,null),O=g.exports,C=s("5cab"),k=s("d173"),$=s.n(k),x=s("6e2d"),D=s("b35e"),S=s("e6dc"),A={components:{Icon:n["a"],FilterPopup:O,HistoryOrderDetails:C["default"],Pair:D["a"]},data:function(){return{activeNames:["1"],filterModalDisplayed:!1,currentPage:1,orderDetail:{},shouldShowOrderDetailsDialog:!1,filteredIds:[],isLoadingDetails:!1,filter:{code:null}}},computed:Object(o["a"])(Object(o["a"])(Object(o["a"])({},Object(l["c"])(["display","orderModalDisplayed","pagination","sales","reportOrders","loading","searchFilter"])),Object(l["c"])("authentication",[v["d"],v["f"]])),{},{user:function(){return this[v["d"]]},selectedStoreAddresses:function(){return this[v["f"]]},isMCD:function(){return!!(this.user&&this.user.store.storeAddresses&&this.user.store.storeAddresses.length>0)&&this.user.store.storeAddresses[0].mcd},selectedFilters:function(){var t=this,e=this.searchFilter.period.option?1:0;return e+=this.searchFilter.incidents?Object.keys(this.searchFilter.incidents).filter((function(e){return!!t.searchFilter.incidents[e]})).length:0,e+=this.searchFilter.courierPaidWithCash?1:0,e+=this.searchFilter.orderPaidWithCard?1:0,0===e?null:e},storeAddressIds:function(){return 0===this.filteredIds.length?this.selectedStoreAddresses:this.filteredIds}}),watch:{selectedStoreAddresses:function(){this.refresh(this.selectedStoreAddresses)}},mounted:function(){this.displayState(d["DISPLAY_REPORTS_HISTORY"]),this.refresh(this.storeAddressIds)},activated:function(){this.displayState(d["DISPLAY_REPORTS_HISTORY"])},methods:Object(o["a"])(Object(o["a"])({},Object(l["b"])(["changeModalDisplay","displayState","setOrderDetails","setReportOrders","setSearchFilter","setStatistics","updateSearch","exportToExcel"])),{},{changeOrderDetailVisibility:function(t){this.shouldShowOrderDetailsDialog=t},changeFilterModalDisplay:function(){this.filterModalDisplayed=!1},showOrderDetail:function(t){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function s(){return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return e.isLoadingDetails=!0,e.shouldShowOrderDetailsDialog=!0,s.next=4,e.setOrderDetails(t);case 4:e.isLoadingDetails=!1;case 5:case"end":return s.stop()}}),s)})))()},refresh:function(t){t&&0===t.length&&(t=this.selectedStoreAddresses),this.setStatistics(t),this.setReportOrders({page:this.currentPage,storeAddressIds:t})},handleSizeChange:function(){},handleCurrentChange:function(){this.setReportOrders({page:this.currentPage,storeAddressIds:this.storeAddressIds})},excel:function(){this.exportToExcel(this.storeAddressIds)},updateSelectedAddresses:function(t){this.filteredIds=t},hasBadRatings:function(t){return t.badRatingReasons&&$()(t.badRatingReasons,x["a"].badRatingReasons()).length>0},filterReports:function(t){this.filterModalDisplayed=!1,this.updateSearch({searchFilter:t,storeAddressIds:this.storeAddressIds})},searchByCode:function(){this.updateSearch({searchFilter:this.searchFilter,storeAddressIds:this.storeAddressIds})},totalPrice:function(t){return Object(S["a"])(t.totalPrice)},pickupCodeText:function(t){var e;return null!==(e=null===t||void 0===t?void 0:t.pickupCode)&&void 0!==e?e:"-"}})},F=A,P=(s("07f8"),Object(m["a"])(F,i,r,!1,null,null,null));e["default"]=P.exports},bb42:function(t,e,s){},f0a0:function(t,e,s){}}]);